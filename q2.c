/**
 * Implementation of arbitrary length LFSR.
 * Input: binary sequence describing the LFSR.
 * Output: binary sequence generated by the LFSR in one period.
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <limits.h>
#include "lfsr.h"

#define MAX_SIZE 1024


void usage(char *name) {
	printf("Given the key stream of a LFSR detect the connection polynomial and its length using Berlekamp-Massey algorithm.\nUsage: ");
	printf("%s BINARY_KEYSTREAM\n", name);
}

int main(int argc, char *argv[]) {
	char *output_sequence = argv[1];
	int output_sequence_int[MAX_SIZE];
	int desc_int[MAX_SIZE];
	char desc[MAX_SIZE];
	char desc_poly[MAX_SIZE];
	int i, n = 0, l;

	if (argc != 2) {
		usage(argv[0]);
		return 1;
	}

	memset(desc_int, 0, MAX_SIZE * sizeof(int));
	memset(output_sequence_int, 0, MAX_SIZE * sizeof(int));

	// Convert sequence into an array of ints
	for (i = 0; output_sequence[i] != '\0'; i++) {
		output_sequence_int[i] = c2b(output_sequence[i]);
		n++;
	}
	// Compute BMA
	l = bma(output_sequence_int, desc_int, n);
	// Convert description polynomial into a string
	for (i = 0; i < l + 1; ++i)
	{
		desc[i] = (desc_int[i] == 0)? '0' : '1';
	}
	desc[i] = '\0';

	printf("Length: %d\n", l);
	get_poly_str(desc_int, strlen(desc), desc_poly);
	printf("Connection polynomial: %s (binary: %s)\n", desc_poly, desc);

	return 0;
}